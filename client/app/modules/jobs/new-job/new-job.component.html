<a class="ui button" routerLink="/jobs">
    <i class="chevron left icon"></i>Back to List
</a>

<h1>
    Create New Job
</h1>

<form #form="ngForm" class="ui form" id="new-job-form"
      (ngSubmit)="onSubmit(form)"
      novalidate>

    <!--Final Generated Name-->
    <div class="inline fields">
        <div class="read-only ten wide field">
            <label>Generated Name</label>
            <div *ngIf="usingFinalName" class="ui icon input" [class.loading]="generating">
                <input readonly="" type="text"
                       require
                       [(ngModel)]="finalName.result"
                       name="finalName">
                <i class="icon"></i>
            </div>
            <input *ngIf="!usingFinalName" readonly="" type="text"
                   require
                   [(ngModel)]="job.name"
                   name="finalName">
        </div>
        <div class="six wide field">
            <div class="ui toggle checkbox">
                <input type="checkbox" tabindex="0" class="hidden"
                       [checked]="usingFinalName"
                       (change)="usingFinalName = !usingFinalName">
                <label>Use generated name?</label>
            </div>
        </div>
    </div>

    <!--Client & Brand-->
    <div class="two fields">
        <div class="field" id="client-select-field">
            <label>Client
                (can't find it?
                <a id="new-client-popup" class="popup-trigger">
                    <i class="help circle icon"></i>check me out
                </a>
                <div class="ui popup">
                    You can go <a routerLink="/clients/new">here</a> to create a new Client.
                    We save most fields, so don't worry about going off to a different page.
                    Come back here when you're done~ :D
                </div>
                )
            </label>
            <select class="ui search dropdown selection"
                    [(ngModel)]="job.client"
                    (ngModelChange)="this.submitted = false; onClientChange()"
                    name="client">
                <option value=" ">(no client)</option>
                <option *ngFor="let cli of clients; let i = index"
                        [ngValue]="cli">
                    {{cli.name}} <span *ngIf="!commonService.isEmptyString(cli.shortCode)">- ({{cli.shortCode}})</span>
                </option>
            </select>
        </div>
        <div class="field" id="brand-select-field">
            <label>
                Brand
                <span [class.hidden]="commonService.isEmptyString(job?.client?.name)">
                    (can't find it?
                    <a id="new-brand-popup" class="popup-trigger"><i class="add icon"></i>add new</a>
                    <div class="ui popup" id="new-brand-popup-form">
                        <div class="ui input">
                          <input type="text" placeholder="(enter new brand)" #newBrandInput>
                        </div>
                        <div class="ui positive button"
                             (click)="addNewBrand(newBrandInput.value); newBrandInput.value = ''">Save</div>
                        <div class="ui button" (click)="addNewBrand('')">Cancel</div>
                    </div>
                    )
                </span>
                <span [class.hidden]="!commonService.isEmptyString(job?.client?.name)">
                    (needs client)
                </span>
            </label>
            <select class="ui search dropdown selection"
                    [(ngModel)]="job.brand"
                    (ngModelChange)="this.submitted = false; onBrandChange()"
                    name="brand">
                <option value=" ">(no brand)</option>
                <option *ngFor="let b of job.client.brands; let i = index"
                        [value]="b">{{b}}
                </option>
            </select>
        </div>
    </div>

    <!--Job Name-->
    <div class="required field" [class.error]="submitted && !name.valid">
        <label>Job Name</label>
        <input type="text"
               placeholder="(required name)"
               autofocus
               required
               [(ngModel)]="job.name"
               (ngModelChange)="this.submitted = false; onJobNameChange();"
               name="name"
               #name="ngModel">
    </div>

    <!--Start and End Dates-->
    <div class="two fields">
        <div class="required field" [class.error]="!startDate.valid">
            <label>Start Date (Month/Day/Year)</label>
            <input type="date"
                   required
                   [(ngModel)]="job.startDate"
                   (ngModelChange)="this.submitted = false; onDateChange('start', $event)"
                   name="startDate"
                   #startDate="ngModel">
        </div>
        <div class="required field" [class.error]="!endDate.valid">
            <label>End Date (Month/Day/Year)</label>
            <input type="date"
                   required
                   [(ngModel)]="job.endDate"
                   (ngModelChange)="this.submitted = false; onDateChange('end', $event)"
                   name="endDate"
                   #endDate="ngModel">
        </div>
    </div>

    <!--Description-->
    <div class="field">
        <label>Description</label>
        <textarea [(ngModel)]="job.description"
                  rows="3"
                  placeholder="(enter description)"
                  name="description">
        </textarea>
    </div>


    <br><br>
    <!--Tags-->
    <div class="field">
        <label>Tags/Producers (can't find yours?
            <a id="new-tag-popup" class="popup-trigger"><i class="add icon"></i>add new</a>
            <div class="ui popup" id="new-tag-popup-form">
                <div class="ui input">
                    <input type="text" placeholder="(enter new tag)" #newTagInput>
                </div>
                <div class="ui positive button"
                     (click)="addNewTag(newTagInput.value); newTagInput.value = ''">Save
                </div>
                <div class="ui button" (click)="addNewTag('')">Cancel</div>
            </div>
            )
        </label>
        <select multiple="" class="ui fluid search selection dropdown"
                [(ngModel)]="job.tags"
                name="tags"
                #tagSelect="ngModel">
            <!--disabled will prevent selection of empty string tags-->
            <option value="" disabled="true">(select tags)</option>
            <option *ngFor="let t of tags;"
                    [value]="t.name">{{t.name}}
            </option>
        </select>
    </div>

    <!--Rate Card Selector-->
    <app-rate-card-selector
            (onRateUpdated)="onRateUpdated($event)"
            #rateCardSelector>
    </app-rate-card-selector>

    <!--Service Type-->
    <div class="two fields">
        <div class="grouped fields">
            <label>Service Type</label>
            <div class="field">
                <div class="radio" *ngFor="let serviceType of serviceTypes">
                    <label>
                        <input type="radio" name="type" [(ngModel)]="job.serviceType" [value]="serviceType.value">
                        {{serviceType.display}}
                    </label>
                </div>
            </div>
        </div>
        <div class="grouped fields">
            <label>Create a Slack Channel?</label>
            <div class="field">
                <div class="radio">
                    <label><input #y type="radio" name="slack" (click)="createSlackChannelToggle='yes'"
                                  [checked]="createSlackChannelToggle=='yes'"
                                  value="yes">
                        Yes</label>
                </div>
                <div class="radio">
                    <label><input #n type="radio" name="slack" (click)="createSlackChannelToggle='no'"
                                  [checked]="createSlackChannelToggle=='no'"
                                  value="no">
                        No</label>
                </div>
            </div>
        </div>
    </div>

    <!--TODO: remaining features
        projectStatus select
        serviceType (toggle or select or radial)
        tags (form/list display like cakebook's ingredients; be careful of enter button)
        phases (not MVP(?))
    -->
    <div class="ui divider"></div>
    <div class="ui right floated large buttons">
        <button type="button" class="ui negative button"
                (click)="confirmResetModels()"><i class="refresh icon"></i>Clear
        </button>
        <div class="or"></div>
        <button type="submit" class="ui positive button"
                [disabled]="!form.form.valid || submitted"><i class="checkmark icon"></i>Submit
        </button>
    </div>

</form>


<div class="ui small modal" id="confirm-reset-job">
    <i class="close icon"></i>
    <div class="header">
        Are you sure you want to reset the fields on this form?
    </div>
    <div class="actions">
        <div class="ui positive button" (click)="resetModels()"><i class="checkmark icon"></i>I'm sure!</div>
        <div class="ui negative button"><i class="remove icon"></i>Nope</div>
    </div>
</div>


<!--Final Confirmation Screen-->
<div class="ui long modal" id="confirm-new-job">
    <!--<i class="close icon"></i>-->
    <div class="header">
        Almost there!
    </div>
    <div class="content">
        <!--TODO: display message representing current action-->
        <div class="ui active centered inline loader"
             *ngIf="!canEndConfirm"></div>
        <h2 class="ui center aligned icon header"
            *ngIf="canEndConfirm">
            <i class="green circular checkmark icon"></i>
            Done
        </h2>
        <h3 class="ui center aligned small header">
            <span *ngIf="confirmedJobInfo?.tenKId">
                10,000 Project URL:
                <a target="_blank" href="https://vnext.10000ft.com/viewproject?id={{confirmedJobInfo.tenKId}}">
                    {{"https://vnext.10000ft.com/viewproject?id=" + confirmedJobInfo.tenKId | characterLimit: 35}}
                </a>
            </span><br *ngIf="confirmedJobInfo?.tenKId">
            <span *ngIf="confirmedJobInfo?.boxId">
                Box Folder URL:
                <a target="_blank" href="https://fancypantsgroup.app.box.com/files/0/f/{{confirmedJobInfo.boxId}}">
                    {{"https://fancypantsgroup.app.box.com/files/0/f/" + confirmedJobInfo.boxId | characterLimit: 35}}
                </a>
            </span><br *ngIf="confirmedJobInfo?.boxId">
            <span *ngIf="confirmedJobInfo?.trelloId">
                Trello Board URL:
                <a target="_blank" href="https://trello.com/b/{{confirmedJobInfo.trelloId}}">
                    {{"https://trello.com/b/" + confirmedJobInfo.trelloId | characterLimit: 35}}
                </a>
            </span>
        </h3>
        <hr>
        <br>

        <div class="ui grid">
            <div class="centered ten wide mobile eight wide tablet six wide computer column">
                <div *ngIf="rateCardProcessingState != 'disabled'">
                    <h4 class="ui header">Processing rate card...</h4>
                    <div class="ui list">
                        <div class="item">
                            <i class="big icon"
                               [ngClass]="{'active pulse': rateCardProcessingState == 'active',
                               'money': rateCardProcessingState != 'completed'
                                    && rateCardProcessingState != 'failed',
                               'green checkmark': rateCardProcessingState == 'completed',
                               'red remove': rateCardProcessingState == 'failed'}"></i>
                            <div class="content">
                                <div class="header">Rate Card</div>
                                <div class="description">Copying bill rates over from template rate card</div>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 class="ui header">Creating Folders in Box...</h4>
                <div class="ui list">
                    <div class="item">
                        <i class="big icon"
                           [ngClass]="{'disabled': boxProcessingStates.client == 'disabled',
                           'active pulse': boxProcessingStates.client == 'active',
                           'users': boxProcessingStates.client != 'completed' && boxProcessingStates.client != 'failed',
                           'green checkmark': boxProcessingStates.client == 'completed',
                           'red remove': boxProcessingStates.client == 'failed'}"></i>
                        <div class="content">
                            <div class="header">Client</div>
                            <div class="description">Finding a folder with the client's name</div>
                        </div>
                    </div>
                    <div class="item">
                        <i class="big icon"
                           [ngClass]="{'disabled': boxProcessingStates.brand == 'disabled',
                           'active pulse': boxProcessingStates.brand == 'active',
                           'trademark': boxProcessingStates.brand != 'completed' && boxProcessingStates.brand != 'failed',
                           'green checkmark': boxProcessingStates.brand == 'completed',
                           'red remove': boxProcessingStates.brand == 'failed'}"></i>
                        <div class="content">
                            <div class="header">Brand</div>
                            <div class="description">Finding a folder with the brand name</div>
                        </div>
                    </div>
                    <div class="item">
                        <i class="big icon {{boxProcessingStates.job}}"
                           [ngClass]="{'disabled': boxProcessingStates.job == 'disabled',
                           'active pulse': boxProcessingStates.job == 'active',
                           'suitcase': boxProcessingStates.job != 'completed' && boxProcessingStates.job != 'failed',
                           'green checkmark': boxProcessingStates.job == 'completed',
                           'red remove': boxProcessingStates.job == 'failed'}"></i>
                        <div class=" content">
                            <div class="header">Job</div>
                            <div class="description no-padding">Creating a folder with the job's coded name</div>
                        </div>
                    </div>
                </div>

                <div *ngIf="trelloProcessingState != 'disabled'">
                    <h4 class="ui header">Copying Trello board...</h4>
                    <div class="ui list">
                        <div class="item">
                            <i class="big icon {{trelloProcessingState}}"
                               [ngClass]="{'active pulse': trelloProcessingState == 'active',
                               'trello': trelloProcessingState != 'completed'
                                    && trelloProcessingState != 'failed',
                               'green checkmark': trelloProcessingState == 'completed',
                               'red remove': trelloProcessingState == 'failed'}"></i>
                            <div class="content">
                                <div class="header">Board</div>
                                <div class="description">Creating a new board using FPG template</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="actions">
        <a class="ui button" routerLink="/jobs">
            <i class="chevron left icon"></i>Back to List
        </a>
        <div class="ui positive button"
             [class.disabled]="!canEndConfirm"
             (click)="endFinalConfirmation()">
            Check It Out<i class="chevron right icon"></i>
        </div>
    </div>
</div>